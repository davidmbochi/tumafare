<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap-5.1.3-dist/css/bootstrap.css}" >
    <link rel="stylesheet" type="text/css" th:href="@{/css/payment/payment.css}" >
</head>
<body>
<div class="container payment-dashboard">
    <a th:href="@{/}" class="btn btn-primary">Home</a>

    <a sec:authorize="hasAuthority('ADMIN')" th:href="@{/admin}" class="btn btn-primary">Admin</a>

    <a th:href="@{/mpesa/initiate-mpesa}" class="btn btn-primary">Send money</a>

    <a th:href="@{/logout}" class="btn btn-primary">Logout</a>
</div>
<div class="container card dashboard">
    <h3 class="text-center">Transactions</h3>

    <table class="table table-striped table-hover">
        <thead class="table-dark">
        <tr>
            <th scope="col">Date</th>
            <th scope="col">Amount</th>
            <th scope="col">From</th>
            <th scope="col">To</th>
            <th scope="col"> Mpesa status</th>
            <th scope="col"></th>
            <th scope="col"> Payment status</th>
            <th scope="col"></th>
            <th scope="col"></th>
            <th scope="col"></th>

        </tr>
        </thead>
        <tbody>
        <tr th:each="payment : ${payments}">
            <td th:text="${#temporals.format(payment.createdDate, 'dd-MM-yyyy HH:mm')}"></td>
            <td th:text="${payment.amount}"></td>
            <td th:text="${payment.userPhoneNumber}"></td>
            <td th:text="${payment.clientPhoneNumber}"></td>
            <td th:text="${payment.mpesaStatus}"></td>
            <td>
                <a
                        th:href="@{${'/mpesa/refresh-mpesa/'+payment.invoiceId+'/'+payment.id}}"
                        th:if="${!payment.mpesaStatus.equals('COMPLETE')}"
                        class="btn btn-primary">Refresh M-pesa</a>
            </td>
            <td th:text="${payment.paymentStatus}"></td>
            <td>
                <a
                        th:href="@{${'/mpesa/approve-mpesa/'+payment.id}}"
                        th:if="${payment.mpesaStatus.equals('COMPLETE')
                        && !payment.paymentStatus.equals('COMPLETE')
                        && !payment.paymentStatus.equals('CANCELED')
                        && !payment.paymentStatus.equals('APPROVED')
                        && !payment.paymentStatus.equals('REVERSED')
                        }"
                        onclick="return confirm('Are you sure you want to approve this payment?');"
                        class="btn btn-primary">Approve payment </a>

            </td>
            <td>
                <a
                        th:href="@{${'/mpesa/cancel-mpesa/'+payment.id}}"
                        th:if="${payment.mpesaStatus.equals('COMPLETE')
                         && !payment.paymentStatus.equals('COMPLETE')
                         && !payment.paymentStatus.equals('APPROVED')
                         && !payment.paymentStatus.equals('CANCELED')
                         && !payment.paymentStatus.equals('REVERSED')
                         }"
                        onclick="return confirm('Are you sure you want to Cancel this payment?');"
                        class="btn btn-primary">Cancel payment </a>

            </td>
            <td>
                <a
                        th:href="@{${'/mpesa/delete-mpesa/'+payment.id}}"
                        onclick="return confirm('Are you sure you want to delete this payment?');"
                        class="btn btn-danger">Delete payment</a>
            </td>
        </tr>
        </tbody>
    </table>
</div>



</body>
</html>